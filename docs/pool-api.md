# Poll API

Poll API provides a stream of Doma Protocol events. These events could be used to build your own representation of Doma protocol state, analytics, or any kind of processing.

API works using Poll -> Acknowledge system. It means that to receive new events, older events should be acknowledged. Sample integration could look like this:

1. Call [Poll API](#get-v1-poll) to get new events. Optional `limit` and `eventTypes` could be specified.
2. Process events (store in database, send to message queue, etc.).
3. Call [Poll Ack API](#post-v1-poll-ack-lasteventid) to acknowledge last received event (you can use `lastId` from response). This would acknowledge all of the events from polled batch.

Tips:

* To process events one-by-one, specify `limit=1` in Poll API call.
* To reprocess already received events (e.g. if new event type is added), [Poll Reset API](#post-v1-poll-reset-eventid) can be used to rewind polling cursor to a lower id. To reset cursor to the beginning, `eventId` should be set to `0`.
* Each returned event has a `uniqueId` field, that can be used as an idempotency key for events processing.

## Poll for new Doma Protocol events

> Returns blockchain events that have occurred since the last acknowledged event.

```json
{"openapi":"3.0.0","info":{"title":"Doma Registrar API","version":"1.0"},"servers":[{"url":"https://api-testnet.doma.xyz","name":"Doma Testnet API"}],"security":[{"Api-Key":[]}],"components":{"securitySchemes":{"Api-Key":{"type":"apiKey","in":"header","name":"Api-Key"}}},"paths":{"/v1/poll":{"get":{"description":"Returns blockchain events that have occurred since the last acknowledged event.","operationId":"PollApiController_events","parameters":[{"name":"eventTypes","required":false,"in":"query","description":"Filter events by type. Can be provided multiple times to filter by multiple types.","schema":{"type":"array","items":{"type":"string","enum":["NAME_TOKENIZATION_REQUESTED","NAME_TOKENIZATION_REJECTED","NAME_TOKENIZED","NAME_UPDATED","NAME_RENEWED","NAME_CLAIMED","NAME_CLAIM_REQUESTED","NAME_CLAIM_REJECTED","NAME_CLAIM_APPROVED","NAME_DETOKENIZED","NAME_TOKEN_MINTED","NAME_TOKEN_TRANSFERRED","NAME_TOKEN_RENEWED","NAME_TOKEN_BURNED","NAME_TOKEN_APPROVED_FOR_ALL","NAME_TOKEN_TRANSFER_APPROVED","NAME_TOKEN_TRANSFER_APPROVAL_REVOKED","NAME_TOKEN_LOCK_STATUS_CHANGED","PAYMENT_FULFILLED","NAME_TOKEN_LISTED","NAME_TOKEN_OFFER_RECEIVED","NAME_TOKEN_LISTING_CANCELLED","NAME_TOKEN_OFFER_CANCELLED","NAME_TOKEN_PURCHASED","COMMAND_CREATED","COMMAND_SUCCEEDED","COMMAND_FAILED","COMMAND_UPDATED"]}}},{"name":"limit","required":false,"in":"query","description":"Maximum number of events to return in a single response page.","schema":{"minimum":1}},{"name":"finalizedOnly","required":false,"in":"query","description":"Whether to return only finalized events.","schema":{"default":true,"type":"boolean"}}],"responses":{"200":{"description":"","content":{"application/json":{"schema":{"type":"object","properties":{"events":{"description":"List of events.","type":"array","items":{"type":"object","properties":{"id":{"type":"number","description":"Unique event id."},"name":{"type":"string","description":"Associated name. Returned only for name-specific events."},"tokenId":{"type":"string","description":"Associated name token id. Returned only for token-specific events."},"type":{"description":"Event type.","allOf":[{"type":"string","enum":["NAME_TOKENIZATION_REQUESTED","NAME_TOKENIZATION_REJECTED","NAME_TOKENIZED","NAME_UPDATED","NAME_RENEWED","NAME_CLAIMED","NAME_CLAIM_REQUESTED","NAME_CLAIM_REJECTED","NAME_CLAIM_APPROVED","NAME_DETOKENIZED","NAME_TOKEN_MINTED","NAME_TOKEN_TRANSFERRED","NAME_TOKEN_RENEWED","NAME_TOKEN_BURNED","NAME_TOKEN_APPROVED_FOR_ALL","NAME_TOKEN_TRANSFER_APPROVED","NAME_TOKEN_TRANSFER_APPROVAL_REVOKED","NAME_TOKEN_LOCK_STATUS_CHANGED","PAYMENT_FULFILLED","NAME_TOKEN_LISTED","NAME_TOKEN_OFFER_RECEIVED","NAME_TOKEN_LISTING_CANCELLED","NAME_TOKEN_OFFER_CANCELLED","NAME_TOKEN_PURCHASED","COMMAND_CREATED","COMMAND_SUCCEEDED","COMMAND_FAILED","COMMAND_UPDATED"]}]},"uniqueId":{"type":"string","description":"Globally unique event id. Generated from a public on-chain data. Could be used to track same events across different systems."},"relayId":{"type":"string","description":"Relay ID that was used to submit a transaction that triggered this event. Will only be present for events triggered by the Relay API."},"eventData":{"description":"Event-specific data.","oneOf":[{"type":"object","properties":{"networkId":{"type":"string","description":"CAIP2 Chain Id."},"finalized":{"type":"boolean","description":"Whether this even is finalized on-chain."},"txHash":{"type":"string","description":"Transaction hash."},"blockNumber":{"type":"string","description":"Block height from which the event was indexed."},"logIndex":{"type":"number","description":"Field specific for EVM chains. Index of a an even log in a block. Together with blockNumber and networkId it uniquely identifies an event."},"tokenAddress":{"type":"string","description":"NFT contract address"},"tokenId":{"type":"string","description":"Token ID"},"type":{"description":"Blockchain event type","allOf":[{"type":"string","enum":["NAME_TOKEN_MINTED"]}]},"owner":{"type":"string","description":"Token owner."},"name":{"type":"string","description":"Associated name."},"expiresAt":{"type":"string","description":"Expiration date. ISO8601 format.","format":"date-time"},"correlationId":{"type":"string","description":"Correlation ID. Used to associate events with each other. Events that are part of the same operation will have the same correlation ID."}},"required":["networkId","finalized","blockNumber","tokenAddress","tokenId","type","owner","name","expiresAt"]},{"type":"object","properties":{"networkId":{"type":"string","description":"CAIP2 Chain Id."},"finalized":{"type":"boolean","description":"Whether this even is finalized on-chain."},"txHash":{"type":"string","description":"Transaction hash."},"blockNumber":{"type":"string","description":"Block height from which the event was indexed."},"logIndex":{"type":"number","description":"Field specific for EVM chains. Index of a an even log in a block. Together with blockNumber and networkId it uniquely identifies an event."},"tokenAddress":{"type":"string","description":"NFT contract address"},"tokenId":{"type":"string","description":"Token ID"},"type":{"description":"Blockchain event type.","allOf":[{"type":"string","enum":["NAME_TOKEN_BURNED"]}]},"owner":{"type":"string","description":"Owner."}},"required":["networkId","finalized","blockNumber","tokenAddress","tokenId","type","owner"]},{"type":"object","properties":{"networkId":{"type":"string","description":"CAIP2 Chain Id."},"finalized":{"type":"boolean","description":"Whether this even is finalized on-chain."},"txHash":{"type":"string","description":"Transaction hash."},"blockNumber":{"type":"string","description":"Block height from which the event was indexed."},"logIndex":{"type":"number","description":"Field specific for EVM chains. Index of a an even log in a block. Together with blockNumber and networkId it uniquely identifies an event."},"tokenAddress":{"type":"string","description":"NFT contract address"},"tokenId":{"type":"string","description":"Token ID"},"type":{"description":"Blockchain event type.","allOf":[{"type":"string","enum":["NAME_TOKEN_TRANSFERRED"]}]},"from":{"type":"string","description":"Sender."},"to":{"type":"string","description":"Recipient."}},"required":["networkId","finalized","blockNumber","tokenAddress","tokenId","type","from","to"]},{"type":"object","properties":{"networkId":{"type":"string","description":"CAIP2 Chain Id."},"finalized":{"type":"boolean","description":"Whether this even is finalized on-chain."},"txHash":{"type":"string","description":"Transaction hash."},"blockNumber":{"type":"string","description":"Block height from which the event was indexed."},"logIndex":{"type":"number","description":"Field specific for EVM chains. Index of a an even log in a block. Together with blockNumber and networkId it uniquely identifies an event."},"tokenAddress":{"type":"string","description":"NFT contract address."},"type":{"description":"Blockchain event type.","allOf":[{"type":"string","enum":["NAME_TOKEN_APPROVED_FOR_ALL"]}]},"owner":{"type":"string","description":"Token owner."},"operator":{"type":"string","description":"Approved operator address."},"approved":{"type":"boolean","description":"Approval status."}},"required":["networkId","finalized","blockNumber","tokenAddress","type","owner","operator","approved"]},{"type":"object","properties":{"networkId":{"type":"string","description":"CAIP2 Chain Id."},"finalized":{"type":"boolean","description":"Whether this even is finalized on-chain."},"txHash":{"type":"string","description":"Transaction hash."},"blockNumber":{"type":"string","description":"Block height from which the event was indexed."},"logIndex":{"type":"number","description":"Field specific for EVM chains. Index of a an even log in a block. Together with blockNumber and networkId it uniquely identifies an event."},"tokenAddress":{"type":"string","description":"NFT contract address"},"tokenId":{"type":"string","description":"Token ID"},"type":{"description":"Blockchain event type.","allOf":[{"type":"string","enum":["NAME_TOKEN_LOCK_STATUS_CHANGED"]}]},"isTransferLocked":{"type":"boolean","description":"Whether the transfer is locked for a given token."},"correlationId":{"type":"string","description":"Correlation ID. Used to associate events with each other. Events that are part of the same operation will have the same correlation ID."}},"required":["networkId","finalized","blockNumber","tokenAddress","tokenId","type","isTransferLocked"]},{"type":"object","properties":{"networkId":{"type":"string","description":"CAIP2 Chain Id."},"finalized":{"type":"boolean","description":"Whether this even is finalized on-chain."},"txHash":{"type":"string","description":"Transaction hash."},"blockNumber":{"type":"string","description":"Block height from which the event was indexed."},"logIndex":{"type":"number","description":"Field specific for EVM chains. Index of a an even log in a block. Together with blockNumber and networkId it uniquely identifies an event."},"type":{"description":"Blockchain event type.","allOf":[{"type":"string","enum":["PAYMENT_FULFILLED"]}]},"paymentContract":{"type":"string","description":"Payment contract address."},"buyer":{"type":"string","description":"Buyer."},"amount":{"type":"string","description":"Amount paid."},"tokenAddress":{"type":"string","description":"Address of the token used for payment."},"paymentId":{"type":"string","description":"Payment ID."},"immediateMint":{"type":"boolean","description":"True if it should be minted immediately."}},"required":["networkId","finalized","blockNumber","type","paymentContract","buyer","amount"]},{"type":"object","properties":{"networkId":{"type":"string","description":"CAIP2 Chain Id."},"finalized":{"type":"boolean","description":"Whether this even is finalized on-chain."},"txHash":{"type":"string","description":"Transaction hash."},"blockNumber":{"type":"string","description":"Block height from which the event was indexed."},"logIndex":{"type":"number","description":"Field specific for EVM chains. Index of a an even log in a block. Together with blockNumber and networkId it uniquely identifies an event."},"tokenAddress":{"type":"string","description":"NFT contract address"},"tokenId":{"type":"string","description":"Token ID"},"type":{"description":"Blockchain event type.","allOf":[{"type":"string","enum":["NAME_TOKEN_TRANSFER_APPROVED"]}]},"operator":{"type":"string","description":"Approved operator address."},"approvalId":{"type":"number","description":"Approval ID."}},"required":["networkId","finalized","blockNumber","tokenAddress","tokenId","type","operator","approvalId"]},{"type":"object","properties":{"networkId":{"type":"string","description":"CAIP2 Chain Id."},"finalized":{"type":"boolean","description":"Whether this even is finalized on-chain."},"txHash":{"type":"string","description":"Transaction hash."},"blockNumber":{"type":"string","description":"Block height from which the event was indexed."},"logIndex":{"type":"number","description":"Field specific for EVM chains. Index of a an even log in a block. Together with blockNumber and networkId it uniquely identifies an event."},"tokenAddress":{"type":"string","description":"NFT contract address"},"tokenId":{"type":"string","description":"Token ID"},"type":{"description":"Blockchain event type.","allOf":[{"type":"string","enum":["NAME_TOKEN_TRANSFER_APPROVAL_REVOKED"]}]},"operator":{"type":"string","description":"Approved operator address."}},"required":["networkId","finalized","blockNumber","tokenAddress","tokenId","type","operator"]},{"type":"object","properties":{"networkId":{"type":"string","description":"CAIP2 Chain Id."},"finalized":{"type":"boolean","description":"Whether this even is finalized on-chain."},"txHash":{"type":"string","description":"Transaction hash."},"blockNumber":{"type":"string","description":"Block height from which the event was indexed."},"logIndex":{"type":"number","description":"Field specific for EVM chains. Index of a an even log in a block. Together with blockNumber and networkId it uniquely identifies an event."},"tokenAddress":{"type":"string","description":"NFT contract address"},"tokenId":{"type":"string","description":"Token ID"},"type":{"description":"Blockchain event type.","allOf":[{"type":"string","enum":["NAME_TOKEN_RENEWED"]}]},"expiresAt":{"type":"string","description":"Expiration date. ISO8601 format.","format":"date-time"},"correlationId":{"type":"string","description":"Correlation ID. Used to associate events with each other. Events that are part of the same operation will have the same correlation ID."}},"required":["networkId","finalized","blockNumber","tokenAddress","tokenId","type","expiresAt"]},{"type":"object","properties":{"networkId":{"type":"string","description":"CAIP2 Chain Id."},"finalized":{"type":"boolean","description":"Whether this even is finalized on-chain."},"txHash":{"type":"string","description":"Transaction hash."},"blockNumber":{"type":"string","description":"Block height from which the event was indexed."},"logIndex":{"type":"number","description":"Field specific for EVM chains. Index of a an even log in a block. Together with blockNumber and networkId it uniquely identifies an event."},"domaRecordAddress":{"type":"string","description":"Address of a Doma Record Smart Contract."},"name":{"type":"string","description":"Associated name."},"correlationId":{"type":"string","description":"Correlation ID. Used to associate events with each other. Events that are part of the same operation will have the same correlation ID."},"type":{"description":"Blockchain event type.","allOf":[{"type":"string","enum":["NAME_TOKENIZED"]}]},"expiresAt":{"type":"string","description":"Expiration date. ISO8601 format.","format":"date-time"},"nameservers":{"description":"List of nameserver.","type":"array","items":{"type":"string"}},"dsKeys":{"description":"List of DS Keys.","type":"array","items":{"type":"object","properties":{"keyTag":{"type":"number","description":"DS Key Tag."},"algorithm":{"type":"number","description":"DS Key Algorithm."},"digestType":{"type":"number","description":"DS Key Digest Type."},"digest":{"type":"string","description":"DS Key Digest."}},"required":["keyTag","algorithm","digestType","digest"]}},"claimedBy":{"type":"string","description":"Current wallet address that claimed the name. CAIP-10 format."}},"required":["networkId","finalized","blockNumber","domaRecordAddress","name","type","expiresAt","nameservers","dsKeys","claimedBy"]},{"type":"object","properties":{"networkId":{"type":"string","description":"CAIP2 Chain Id."},"finalized":{"type":"boolean","description":"Whether this even is finalized on-chain."},"txHash":{"type":"string","description":"Transaction hash."},"blockNumber":{"type":"string","description":"Block height from which the event was indexed."},"logIndex":{"type":"number","description":"Field specific for EVM chains. Index of a an even log in a block. Together with blockNumber and networkId it uniquely identifies an event."},"domaRecordAddress":{"type":"string","description":"Address of a Doma Record Smart Contract."},"name":{"type":"string","description":"Associated name."},"correlationId":{"type":"string","description":"Correlation ID. Used to associate events with each other. Events that are part of the same operation will have the same correlation ID."},"type":{"description":"Blockchain event type.","allOf":[{"type":"string","enum":["NAME_UPDATED"]}]},"nameservers":{"description":"List of nameservers.","type":"array","items":{"type":"string"}},"dsKeys":{"description":"List of DS Keys.","type":"array","items":{"type":"object","properties":{"$ref":"#/paths/~1v1~1poll/get/responses/200/content/application~1json/schema/properties/events/items/properties/eventData/oneOf/9/properties/dsKeys/items/properties"},"required":["keyTag","algorithm","digestType","digest"]}}},"required":["networkId","finalized","blockNumber","domaRecordAddress","name","type","nameservers","dsKeys"]},{"type":"object","properties":{"networkId":{"type":"string","description":"CAIP2 Chain Id."},"finalized":{"type":"boolean","description":"Whether this even is finalized on-chain."},"txHash":{"type":"string","description":"Transaction hash."},"blockNumber":{"type":"string","description":"Block height from which the event was indexed."},"logIndex":{"type":"number","description":"Field specific for EVM chains. Index of a an even log in a block. Together with blockNumber and networkId it uniquely identifies an event."},"domaRecordAddress":{"type":"string","description":"Address of a Doma Record Smart Contract."},"name":{"type":"string","description":"Associated name."},"correlationId":{"type":"string","description":"Correlation ID. Used to associate events with each other. Events that are part of the same operation will have the same correlation ID."},"type":{"description":"Blockchain event type.","allOf":[{"type":"string","enum":["NAME_RENEWED"]}]},"expiresAt":{"type":"string","description":"Expiration date. ISO8601 format.","format":"date-time"}},"required":["networkId","finalized","blockNumber","domaRecordAddress","name","type","expiresAt"]},{"type":"object","properties":{"networkId":{"type":"string","description":"CAIP2 Chain Id."},"finalized":{"type":"boolean","description":"Whether this even is finalized on-chain."},"txHash":{"type":"string","description":"Transaction hash."},"blockNumber":{"type":"string","description":"Block height from which the event was indexed."},"logIndex":{"type":"number","description":"Field specific for EVM chains. Index of a an even log in a block. Together with blockNumber and networkId it uniquely identifies an event."},"domaRecordAddress":{"type":"string","description":"Address of a Doma Record Smart Contract."},"name":{"type":"string","description":"Associated name."},"correlationId":{"type":"string","description":"Correlation ID. Used to associate events with each other. Events that are part of the same operation will have the same correlation ID."},"claimedBy":{"type":"string","description":"Wallet address that was used for claim. CAIP-10 format."},"proofSource":{"description":"Indicates the source of contacts information. \"registrantHandle\" is used as a unique identifier within this source. Following values are possible: \n0 - NONE. No contacts provided. Only used for EOIs. \n1 - REGISTRAR. Registrar has approved claim, and holds the contact information. \"registrantHandle\" holds internal registrar-supplied identifier. \n2 - DOMA. Doma has approved claim, and holds the contact information. \"registrantHandle\" holds contacts identifier in Doma API, that should be used with /registrant/{handle} API to obtain encrypted contact information.","allOf":[{"type":"number","enum":[0,1,2]}]},"registrantHandle":{"type":"string","description":"Unique identifier that can be used to obtain contact information."},"type":{"description":"Blockchain event type.","allOf":[{"type":"string","enum":["NAME_CLAIMED"]}]}},"required":["networkId","finalized","blockNumber","domaRecordAddress","name","claimedBy","proofSource","registrantHandle","type"]},{"type":"object","properties":{"networkId":{"type":"string","description":"CAIP2 Chain Id."},"finalized":{"type":"boolean","description":"Whether this even is finalized on-chain."},"txHash":{"type":"string","description":"Transaction hash."},"blockNumber":{"type":"string","description":"Block height from which the event was indexed."},"logIndex":{"type":"number","description":"Field specific for EVM chains. Index of a an even log in a block. Together with blockNumber and networkId it uniquely identifies an event."},"domaRecordAddress":{"type":"string","description":"Address of a Doma Record Smart Contract."},"name":{"type":"string","description":"Associated name."},"correlationId":{"type":"string","description":"Correlation ID. Used to associate events with each other. Events that are part of the same operation will have the same correlation ID."},"type":{"description":"Blockchain event type.","allOf":[{"type":"string","enum":["NAME_DETOKENIZED"]}]}},"required":["networkId","finalized","blockNumber","domaRecordAddress","name","type"]},{"type":"object","properties":{"networkId":{"type":"string","description":"CAIP2 Chain Id."},"finalized":{"type":"boolean","description":"Whether this even is finalized on-chain."},"txHash":{"type":"string","description":"Transaction hash."},"blockNumber":{"type":"string","description":"Block height from which the event was indexed."},"logIndex":{"type":"number","description":"Field specific for EVM chains. Index of a an even log in a block. Together with blockNumber and networkId it uniquely identifies an event."},"domaRecordAddress":{"type":"string","description":"Address of a Doma Record Smart Contract."},"name":{"type":"string","description":"Associated name."},"correlationId":{"type":"string","description":"Correlation ID. Used to associate events with each other. Events that are part of the same operation will have the same correlation ID."},"type":{"description":"Blockchain event type.","allOf":[{"type":"string","enum":["NAME_TOKENIZATION_REQUESTED"]}]},"ownershipTokenChainId":{"type":"string","description":"CAIP-2 chain Id on which tokenization was requested"},"ownershipTokenOwnerAddress":{"type":"string","description":"Owner address on a target chain."}},"required":["networkId","finalized","blockNumber","domaRecordAddress","name","type","ownershipTokenChainId","ownershipTokenOwnerAddress"]},{"type":"object","properties":{"networkId":{"type":"string","description":"CAIP2 Chain Id."},"finalized":{"type":"boolean","description":"Whether this even is finalized on-chain."},"txHash":{"type":"string","description":"Transaction hash."},"blockNumber":{"type":"string","description":"Block height from which the event was indexed."},"logIndex":{"type":"number","description":"Field specific for EVM chains. Index of a an even log in a block. Together with blockNumber and networkId it uniquely identifies an event."},"domaRecordAddress":{"type":"string","description":"Address of a Doma Record Smart Contract."},"name":{"type":"string","description":"Associated name."},"correlationId":{"type":"string","description":"Correlation ID. Used to associate events with each other. Events that are part of the same operation will have the same correlation ID."},"type":{"description":"Blockchain event type.","allOf":[{"type":"string","enum":["NAME_TOKENIZATION_REJECTED"]}]}},"required":["networkId","finalized","blockNumber","domaRecordAddress","name","type"]},{"type":"object","properties":{"relayId":{"type":"string","description":"Associated relay id, that was used to crate this command."},"transactions":{"description":"List of transactions associated with the command event.","type":"array","items":{"type":"object","properties":{"type":{"description":"The type of the blockchain transaction command.","allOf":[{"type":"string","enum":["RELAY","CLAIM","UPDATE_METADATA","SET_REVERSE_MAPPING","SUBMIT_CROSS_CHAIN_MESSAGE"]}]},"status":{"description":"The current status of the blockchain transaction.","allOf":[{"type":"string","enum":["PENDING","SUCCEEDED","FAILED","TIMED_OUT","RETRY_LIMIT_EXCEEDED"]}]},"chainId":{"type":"string","description":"The identifier of the blockchain network where the transaction is executed."},"hash":{"type":"string","description":"The hash of the blockchain transaction."},"signer":{"type":"object","description":"The signer of the transaction, or null if no signer is present."},"gasPrice":{"type":"object","description":"The gas price of the transaction, or null if not available."},"gasUsed":{"type":"object","description":"The gas used by the transaction, or null if not available."}},"required":["type","status","chainId","hash"]}},"failureData":{"description":"Failure data for a failed command. Only present for failed commands. Contains information about the error that caused the command to fail.","nullable":true,"allOf":[{"type":"object","properties":{"chainId":{"type":"string","description":"Chain ID of the blockchain transaction (CAIP-2 format)."},"address":{"type":"object","description":"Address of the contract that failed.","nullable":true},"methodName":{"type":"object","description":"Name of the method that failed.","nullable":true},"methodArgs":{"type":"object","description":"Arguments of the method that failed.","nullable":true},"error":{"description":"Error that caused the command to fail.","nullable":true,"allOf":[{"type":"object","properties":{"name":{"type":"string","description":"Error name."},"args":{"type":"string","description":"Error arguments."},"signature":{"type":"string","description":"Error signature."},"selector":{"type":"string","description":"Error selector."}},"required":["name","args","signature","selector"]}]},"rawError":{"type":"string","description":"Raw error that caused the command to fail."}},"required":["chainId","address","methodName","methodArgs","error","rawError"]}]},"type":{"description":"Command event type","allOf":[{"type":"string","enum":["COMMAND_CREATED"]}]}},"required":["relayId","transactions","failureData","type"]},{"type":"object","properties":{"relayId":{"type":"string","description":"Associated relay id, that was used to crate this command."},"transactions":{"description":"List of transactions associated with the command event.","type":"array","items":{"type":"object","properties":{"$ref":"#/paths/~1v1~1poll/get/responses/200/content/application~1json/schema/properties/events/items/properties/eventData/oneOf/16/properties/transactions/items/properties"},"required":["type","status","chainId","hash"]}},"failureData":{"description":"Failure data for a failed command. Only present for failed commands. Contains information about the error that caused the command to fail.","nullable":true,"allOf":[{"type":"object","properties":{"$ref":"#/paths/~1v1~1poll/get/responses/200/content/application~1json/schema/properties/events/items/properties/eventData/oneOf/16/properties/failureData/allOf/0/properties"},"required":["chainId","address","methodName","methodArgs","error","rawError"]}]},"type":{"description":"Command event type","allOf":[{"type":"string","enum":["COMMAND_SUCCEEDED"]}]}},"required":["relayId","transactions","failureData","type"]},{"type":"object","properties":{"relayId":{"type":"string","description":"Associated relay id, that was used to crate this command."},"transactions":{"description":"List of transactions associated with the command event.","type":"array","items":{"type":"object","properties":{"$ref":"#/paths/~1v1~1poll/get/responses/200/content/application~1json/schema/properties/events/items/properties/eventData/oneOf/16/properties/transactions/items/properties"},"required":["type","status","chainId","hash"]}},"failureData":{"description":"Failure data for a failed command. Only present for failed commands. Contains information about the error that caused the command to fail.","nullable":true,"allOf":[{"type":"object","properties":{"$ref":"#/paths/~1v1~1poll/get/responses/200/content/application~1json/schema/properties/events/items/properties/eventData/oneOf/16/properties/failureData/allOf/0/properties"},"required":["chainId","address","methodName","methodArgs","error","rawError"]}]},"type":{"description":"Command event type","allOf":[{"type":"string","enum":["COMMAND_FAILED"]}]}},"required":["relayId","transactions","failureData","type"]},{"type":"object","properties":{"relayId":{"type":"string","description":"Associated relay id, that was used to crate this command."},"transactions":{"description":"List of transactions associated with the command event.","type":"array","items":{"type":"object","properties":{"$ref":"#/paths/~1v1~1poll/get/responses/200/content/application~1json/schema/properties/events/items/properties/eventData/oneOf/16/properties/transactions/items/properties"},"required":["type","status","chainId","hash"]}},"failureData":{"description":"Failure data for a failed command. Only present for failed commands. Contains information about the error that caused the command to fail.","nullable":true,"allOf":[{"type":"object","properties":{"$ref":"#/paths/~1v1~1poll/get/responses/200/content/application~1json/schema/properties/events/items/properties/eventData/oneOf/16/properties/failureData/allOf/0/properties"},"required":["chainId","address","methodName","methodArgs","error","rawError"]}]},"type":{"description":"Command event type","allOf":[{"type":"string","enum":["COMMAND_UPDATED"]}]}},"required":["relayId","transactions","failureData","type"]},{"type":"object","properties":{"networkId":{"type":"string","description":"CAIP2 Chain Id."},"finalized":{"type":"boolean","description":"Whether this even is finalized on-chain."},"txHash":{"type":"string","description":"Transaction hash."},"blockNumber":{"type":"string","description":"Block height from which the event was indexed."},"logIndex":{"type":"number","description":"Field specific for EVM chains. Index of a an even log in a block. Together with blockNumber and networkId it uniquely identifies an event."},"domaRecordAddress":{"type":"string","description":"Address of a Doma Record Smart Contract."},"name":{"type":"string","description":"Associated name."},"correlationId":{"type":"string","description":"Correlation ID. Used to associate events with each other. Events that are part of the same operation will have the same correlation ID."},"claimedBy":{"type":"string","description":"Wallet address that was used for claim. CAIP-10 format."},"proofSource":{"description":"Indicates the source of contacts information. \"registrantHandle\" is used as a unique identifier within this source. Following values are possible: \n0 - NONE. No contacts provided. Only used for EOIs. \n1 - REGISTRAR. Registrar has approved claim, and holds the contact information. \"registrantHandle\" holds internal registrar-supplied identifier. \n2 - DOMA. Doma has approved claim, and holds the contact information. \"registrantHandle\" holds contacts identifier in Doma API, that should be used with /registrant/{handle} API to obtain encrypted contact information.","allOf":[{"type":"number","enum":[0,1,2]}]},"registrantHandle":{"type":"string","description":"Unique identifier that can be used to obtain contact information."},"type":{"description":"Blockchain event type.","allOf":[{"type":"string","enum":["NAME_CLAIM_REQUESTED"]}]}},"required":["networkId","finalized","blockNumber","domaRecordAddress","name","claimedBy","proofSource","registrantHandle","type"]},{"type":"object","properties":{"networkId":{"type":"string","description":"CAIP2 Chain Id."},"finalized":{"type":"boolean","description":"Whether this even is finalized on-chain."},"txHash":{"type":"string","description":"Transaction hash."},"blockNumber":{"type":"string","description":"Block height from which the event was indexed."},"logIndex":{"type":"number","description":"Field specific for EVM chains. Index of a an even log in a block. Together with blockNumber and networkId it uniquely identifies an event."},"domaRecordAddress":{"type":"string","description":"Address of a Doma Record Smart Contract."},"name":{"type":"string","description":"Associated name."},"correlationId":{"type":"string","description":"Correlation ID. Used to associate events with each other. Events that are part of the same operation will have the same correlation ID."},"claimedBy":{"type":"string","description":"Wallet address that was used for claim. CAIP-10 format."},"proofSource":{"description":"Indicates the source of contacts information. \"registrantHandle\" is used as a unique identifier within this source. Following values are possible: \n0 - NONE. No contacts provided. Only used for EOIs. \n1 - REGISTRAR. Registrar has approved claim, and holds the contact information. \"registrantHandle\" holds internal registrar-supplied identifier. \n2 - DOMA. Doma has approved claim, and holds the contact information. \"registrantHandle\" holds contacts identifier in Doma API, that should be used with /registrant/{handle} API to obtain encrypted contact information.","allOf":[{"type":"number","enum":[0,1,2]}]},"registrantHandle":{"type":"string","description":"Unique identifier that can be used to obtain contact information."},"type":{"description":"Blockchain event type.","allOf":[{"type":"string","enum":["NAME_CLAIM_APPROVED"]}]}},"required":["networkId","finalized","blockNumber","domaRecordAddress","name","claimedBy","proofSource","registrantHandle","type"]},{"type":"object","properties":{"networkId":{"type":"string","description":"CAIP2 Chain Id."},"finalized":{"type":"boolean","description":"Whether this even is finalized on-chain."},"txHash":{"type":"string","description":"Transaction hash."},"blockNumber":{"type":"string","description":"Block height from which the event was indexed."},"logIndex":{"type":"number","description":"Field specific for EVM chains. Index of a an even log in a block. Together with blockNumber and networkId it uniquely identifies an event."},"domaRecordAddress":{"type":"string","description":"Address of a Doma Record Smart Contract."},"name":{"type":"string","description":"Associated name."},"correlationId":{"type":"string","description":"Correlation ID. Used to associate events with each other. Events that are part of the same operation will have the same correlation ID."},"claimedBy":{"type":"string","description":"Wallet address that was used for claim. CAIP-10 format."},"proofSource":{"description":"Indicates the source of contacts information. \"registrantHandle\" is used as a unique identifier within this source. Following values are possible: \n0 - NONE. No contacts provided. Only used for EOIs. \n1 - REGISTRAR. Registrar has approved claim, and holds the contact information. \"registrantHandle\" holds internal registrar-supplied identifier. \n2 - DOMA. Doma has approved claim, and holds the contact information. \"registrantHandle\" holds contacts identifier in Doma API, that should be used with /registrant/{handle} API to obtain encrypted contact information.","allOf":[{"type":"number","enum":[0,1,2]}]},"registrantHandle":{"type":"string","description":"Unique identifier that can be used to obtain contact information."},"type":{"description":"Blockchain event type.","allOf":[{"type":"string","enum":["NAME_CLAIM_REJECTED"]}]}},"required":["networkId","finalized","blockNumber","domaRecordAddress","name","claimedBy","proofSource","registrantHandle","type"]},{"type":"object","properties":{"type":{"description":"Marketplace event type","allOf":[{"type":"string","enum":["NAME_TOKEN_LISTED"]}]},"tokenId":{"type":"string","description":"Token ID"},"tokenAddress":{"type":"string","description":"NFT contract address"},"orderbook":{"description":"Orderbook type","allOf":[{"type":"string","enum":["DOMA","OPENSEA"]}]},"orderId":{"type":"string","description":"Order ID"},"createdAt":{"type":"string","description":"Event creation timestamp","format":"date-time"},"startsAt":{"type":"string","description":"Start date of the listing. ISO8601 format.","format":"date-time"},"expiresAt":{"type":"string","description":"Expiration date of the listing. ISO8601 format.","format":"date-time"},"seller":{"type":"string","description":"Seller address"},"buyer":{"type":"string","description":"Buyer address if this is a private listing"},"payment":{"description":"Payment information","allOf":[{"type":"object","properties":{"price":{"type":"string","description":"Price in the smallest unit of the currency"},"tokenAddress":{"type":"string","description":"Token address used for payment"},"currencySymbol":{"type":"string","description":"Currency symbol"}},"required":["price","tokenAddress","currencySymbol"]}]}},"required":["type","tokenId","tokenAddress","orderbook","orderId","createdAt","startsAt","expiresAt","seller","payment"]},{"type":"object","properties":{"type":{"description":"Marketplace event type","allOf":[{"type":"string","enum":["NAME_TOKEN_OFFER_RECEIVED"]}]},"tokenId":{"type":"string","description":"Token ID"},"tokenAddress":{"type":"string","description":"NFT contract address"},"orderbook":{"description":"Orderbook type","allOf":[{"type":"string","enum":["DOMA","OPENSEA"]}]},"orderId":{"type":"string","description":"Order ID"},"createdAt":{"type":"string","description":"Event creation timestamp","format":"date-time"},"expiresAt":{"type":"string","description":"Expiration date of the offer. ISO8601 format.","format":"date-time"},"buyer":{"type":"string","description":"Buyer address"},"seller":{"type":"string","description":"Seller address"},"payment":{"description":"Payment information","allOf":[{"type":"object","properties":{"$ref":"#/paths/~1v1~1poll/get/responses/200/content/application~1json/schema/properties/events/items/properties/eventData/oneOf/23/properties/payment/allOf/0/properties"},"required":["price","tokenAddress","currencySymbol"]}]}},"required":["type","tokenId","tokenAddress","orderbook","orderId","createdAt","expiresAt","buyer","seller","payment"]},{"type":"object","properties":{"type":{"description":"Marketplace event type","allOf":[{"type":"string","enum":["NAME_TOKEN_LISTING_CANCELLED"]}]},"tokenId":{"type":"string","description":"Token ID"},"tokenAddress":{"type":"string","description":"NFT contract address"},"orderbook":{"description":"Orderbook type","allOf":[{"type":"string","enum":["DOMA","OPENSEA"]}]},"orderId":{"type":"string","description":"Order ID"},"createdAt":{"type":"string","description":"Event creation timestamp","format":"date-time"}},"required":["type","tokenId","tokenAddress","orderbook","orderId","createdAt"]},{"type":"object","properties":{"type":{"description":"Marketplace event type","allOf":[{"type":"string","enum":["NAME_TOKEN_OFFER_CANCELLED"]}]},"tokenId":{"type":"string","description":"Token ID"},"tokenAddress":{"type":"string","description":"NFT contract address"},"orderbook":{"description":"Orderbook type","allOf":[{"type":"string","enum":["DOMA","OPENSEA"]}]},"orderId":{"type":"string","description":"Order ID"},"createdAt":{"type":"string","description":"Event creation timestamp","format":"date-time"}},"required":["type","tokenId","tokenAddress","orderbook","orderId","createdAt"]},{"type":"object","properties":{"type":{"description":"Marketplace event type","allOf":[{"type":"string","enum":["NAME_TOKEN_PURCHASED"]}]},"tokenId":{"type":"string","description":"Token ID"},"tokenAddress":{"type":"string","description":"NFT contract address"},"orderbook":{"description":"Orderbook type","allOf":[{"type":"string","enum":["DOMA","OPENSEA"]}]},"orderId":{"type":"string","description":"Order ID"},"createdAt":{"type":"string","description":"Event creation timestamp","format":"date-time"},"purchasedAt":{"type":"string","description":"Purchase date. ISO8601 format.","format":"date-time"},"seller":{"type":"string","description":"Seller address"},"buyer":{"type":"string","description":"Buyer address"},"payment":{"description":"Payment information","allOf":[{"type":"object","properties":{"$ref":"#/paths/~1v1~1poll/get/responses/200/content/application~1json/schema/properties/events/items/properties/eventData/oneOf/23/properties/payment/allOf/0/properties"},"required":["price","tokenAddress","currencySymbol"]}]},"txHash":{"type":"object","description":"Transaction hash"}},"required":["type","tokenId","tokenAddress","orderbook","orderId","createdAt","purchasedAt","seller","buyer","payment"]}]}},"required":["id","type","eventData"]}},"lastId":{"type":"number","description":"Last returned event id. Should be used with `/poll/ack` API to acknowledge events receive."},"hasMoreEvents":{"type":"boolean","description":"If true, more events might be available. They could be retrieved by acknowledging the last event id, or by increasing the `limit`."}},"required":["events"]}}}},"400":{"description":"Bad Request. Invalid query parameters."},"401":{"description":"Unauthorized. API Key is missing or invalid."},"403":{"description":"Forbidden. API Key is missing 'EVENTS' permission."}},"summary":"Poll for new Doma Protocol events","tags":["Events Poll API"]}}}}
```

## Acknowledge received events

> Updates the last acknowledged event id for the client.

```json
{"openapi":"3.0.0","info":{"title":"Doma Registrar API","version":"1.0"},"servers":[{"url":"https://api-testnet.doma.xyz","name":"Doma Testnet API"}],"security":[{"Api-Key":[]}],"components":{"securitySchemes":{"Api-Key":{"type":"apiKey","in":"header","name":"Api-Key"}}},"paths":{"/v1/poll/ack/{lastEventId}":{"post":{"description":"Updates the last acknowledged event id for the client.","operationId":"PollApiController_acknowledgeEvent","parameters":[{"name":"lastEventId","required":false,"in":"path","description":"Last event id that was processed by the client.","schema":{"type":"integer"}}],"responses":{"200":{"description":""},"400":{"description":"Bad Request. Invalid event id."},"401":{"description":"Unauthorized. API Key is missing or invalid."},"403":{"description":"Forbidden. API Key is missing 'EVENTS' permission."}},"summary":"Acknowledge received events","tags":["Events Poll API"]}}}}
```

## Reset last acknowledged event

> Updates the last acknowledged event id for the client. Can be used to reset the polling state to re-consume events.

```json
{"openapi":"3.0.0","info":{"title":"Doma Registrar API","version":"1.0"},"servers":[{"url":"https://api-testnet.doma.xyz","name":"Doma Testnet API"}],"security":[{"Api-Key":[]}],"components":{"securitySchemes":{"Api-Key":{"type":"apiKey","in":"header","name":"Api-Key"}}},"paths":{"/v1/poll/reset/{eventId}":{"post":{"description":"Updates the last acknowledged event id for the client. Can be used to reset the polling state to re-consume events.","operationId":"PollApiController_resetLastAcknowledgedEventId","parameters":[{"name":"eventId","required":false,"in":"path","description":"Event id to reset the last acknowledged event id to.","schema":{"type":"integer"}}],"responses":{"200":{"description":""},"400":{"description":"Bad Request. Invalid event id."},"401":{"description":"Unauthorized. API Key is missing or invalid."},"403":{"description":"Forbidden. API Key is missing 'EVENTS' permission."}},"summary":"Reset last acknowledged event","tags":["Events Poll API"]}}}}
```
